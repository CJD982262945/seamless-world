## 主要功能

Zeus网络封装层 通信协议 支持：
  - 自定义struct协议。
  - protobuf协议
  - RPC协议

自定义struct协议都需要自己实现封包、解包等函数。

本文只介绍 msgdef包本身。3种协议如何使用，将后续章节分别详细介绍（因为是综合应用，涉及到其他模块；各种规则）。

## struct协议需要实现的接口

```go
// IMsg 消息接口，所有的消息类都必须实现的接口
type IMsg interface {
	MarshalTo(data []byte) (n int, err error)
	Unmarshal(data []byte) error
	Size() (n int)
	Name() string
}
```

**因为protobuf协议也是实现了IMsg接口的，所以zeus层，对struct协议、protobuf协议都支持**


## 消息号

消息号在 zeus/msgdef/MessageConst.go中定义，如下：

```go
const (
	ClientVertifyReqMsgID = 1
	//ClientVertifyReqMsgID 验证消息的ID号
	//ClientVertifySucceedRetMsgID 验证结果成功返回的ID号
	ClientVertifySucceedRetMsgID = 2
	//ClientVertifyFailedRetMsgID 验证结果失败返回的ID号
	ClientVertifyFailedRetMsgID = 3

	// HeartBeatMsgID 心跳消息ID
	HeartBeatMsgID = 4

	// ...(略)...

	// RPCMsgID RPC消息
	RPCMsgID       = 58

	// ...(略)...
)
```

## struct消息类型注册

zeus/msgdef/MsgDef_bytes.go中，注册了所有zeus中用到的struct消息。

```go
// InitBytesMsg 初始字节流消息
func (def *MsgDef) InitBytesMsg() {
	def.RegMsg(ClientVertifyReqMsgID, "ClientVertifyReq", new(ClientVertifyReq))
	def.RegMsg(ClientVertifySucceedRetMsgID, "ClientVertifySucceedRet", new(ClientVertifySucceedRet))
	def.RegMsg(ClientVertifyFailedRetMsgID, "ClientVertifyFailedRet", new(ClientVertifyFailedRet))
	def.RegMsg(HeartBeatMsgID, "HeartBeat", new(HeartBeat))

	// ...(略)...

	def.RegMsg(RPCMsgID, "RPCMsg", new(RPCMsg))

	// ...(略)...
}
```


## RPC协议

所有RPC协议都是通过消息号 msgdef.RPCMsgID (58)传送的。

struct定义如下：

```go
type RPCMsg struct {
	ServerType  uint8
	SrcEntityID uint64
	MethodName  string
	Data        []byte //proto消息参数
}
```

RPC协议，Zeus层已经实现，这里仅做了解下就行。

即，RPC协议是基于struct协议为基础，结合go反射机制实现的。

可以结合看 zeus/msghandler 包代码，了解 RPCMsg.Data 如何解析出参数、RPC回调函数如何被执行等


## 主要API

API                   | 说明
----------------------|-----------------------
msgdef.GetMsgInfo     | 根据消息号，获得名称、消息的类型
msgdef.GetMsgIDByName | 通过名字获取ID号
msgdef.IsMsgExist     | 消息类型是否存在
msgdef.RegMsg         | 注册消息类型


## 源代码分析

内容简单，略
