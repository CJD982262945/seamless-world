## 主要功能

  - 一种场景游戏对象
  - 属性可配置定义
  - 生成后，属性不变
  - 仅有标志自己位置的能力

注意：**TileEntity与Entity系统99%是没有关系的**

## 相关代码
  - zeus/space/TileEntity.go
  - zeus/space/TileEntity_empty.go
  - zeus/space/Space_TinyEntity.go


## TileEntity属性

TileEntity属性定义还是走实体定义那块。（所以上面说TileEntity与Entity系统99%是没有关系的）

如，res/entitydef/Item.json：

```json
{
    "name" : "Item" ,
    "props" : {
        "baseid" : {
            "type" : "uint32" ,
            "save" : "0" ,
            "desc" : "属性"
        },
		 "num" : {
            "type" : "uint32" ,
            "save" : "0" ,
            "desc" : "属性"
        },
		 "reducedam" : {
            "type" : "uint32" ,
            "save" : "0" ,
            "desc" : "耐久"
        }
    },
    // 不起作用字段略
}
```

TileEntity的初始化属性代码：

```go
func (item *SpaceItem) Init(initParam interface{}) {
	// ...(略)...
	item.Setbaseid(mapitem.itemid)
	item.Setnum(mapitem.item.count)
	item.Setreducedam(mapitem.item.reducedam)
	item.SetPos(mapitem.pos)
  // ...(略)...
}
func (e *TinyEntity) SetProp(name string, v interface{}) {
	e.props[name] = &tinyPropInfo{reflect.TypeOf(v).Kind(), v}
}
func (e *TinyEntity) initProps() {
	size := 0
	for name, value := range e.props {
		size = size + len(name) + 2
		size = size + e.getValueStreamSize(value)
	}

	if size == 0 {
		return
	}

	e.packProps = make([]byte, size)
	bs := common.NewByteStream(e.packProps)

	for name, value := range e.props {
		if err := bs.WriteStr(name); err != nil {
			seelog.Error(err, name, e)
		}
		if err := e.writeValueToStream(bs, value); err != nil {
			seelog.Error(err, name, e)
		}
	}
}
```

代码分析：
  - Server层，SpaceItem.Init使用entitydef工具生成的属性方法，设置属性
  - 属性值保存到 TinyEntity.props 中
  - 由于TinyEntity设定为属性不变。因此initProps中直接序列化保存到TinyEntity.packProps字段。用于AOI


## 可以受AOI系统管理

实现了 iserver.ICoordEntity 接口，因此可以受AOI系统管理

```go
func (e *TinyEntity) onInit() {
  // ...(略)...
	if e.GetSpace() != nil {
		e.GetSpace().UpdateCoord(e)
	}
}
```

调用 e.GetSpace().UpdateCoord(e)， 纳入AOI系统。


```go
func (e *TinyEntity) GetAOIProp() (int, []byte) {
	return len(e.props), e.packProps
}
```

AOI系统中的属性发送，会调上面接口。


## Space_TinyEntity.go

管理维护TinyEntity的生命周期、调用流程(模仿Entity的几个回调函数过程，如 onInit、Init等，使之Server层看上去就是一个Entity)。

代码相对简单，略
