<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1431" height="932" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Title:场景创建与Player实体创建流程
Note left of Match: 0. 匹配过程完成后
Note right of Match: 1. 调用 CreateEntityAll("Space", ...)，创建Space实体
Note right of Match: 1-1. 本地创建Space实体类实例
Match->Room: 1-2. 发送 CreateEntityReq 给 Room
Note right of Room: 1-3. 本地创建Space实体类实例
Note right of Room: 2. 初始化场景（包括加载地图数据等）
Room-->>Match: 3. 通知初始化场景完成。\n(Scene.OnMapLoadSucceed函数内，\n发送RPC RoomSpaceInited)
Match->Lobby(s): 4. Match通知Lobby，EnterScene (RPC)
Lobby(s)-->>Room: 5. Lobby通知Room，EnterSpaceReq
Note right of Room: 6. 在MsgProc_EnterSpaceReq内，\n通过space.AddEntity，\n创建Player实体类实例
Room->Gateway: 6-1. 投递给客户端msgdef.EnterSpace，\n包含自己的IP、PORT
Gateway->Client(s): 6-2. 投递给客户端msgdef.EnterSpace
Client(s)-->>Room: 7. 连接Room成功后(包括验证消息等)，\n并发送SpaceUserConnect
Note right of Room: 8. 最终触发SpaceUserSess，\n使client sess具备直接处理实体消息]]></source><desc>场景创建与Player实体创建流程</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"><rect x="10" y="10" width="231.109375" height="30" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="17.21875" y="30.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">场景创建与Player实体创建流程</tspan></text></g><g class="actor"><rect x="153.8828125" y="50" width="63.328125" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="166.1015625" y="74.9921875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="163.8828125">Match</tspan></text></g><g class="actor"><rect x="153.8828125" y="873.21875" width="63.328125" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="166.1015625" y="898.2109375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="163.8828125">Match</tspan></text></g><line x1="185.546875" x2="185.546875" y1="88.875" y2="873.21875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="614.4296875" y="50" width="55.546875" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="626.6484375" y="74.9921875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="624.4296875">Room</tspan></text></g><g class="actor"><rect x="614.4296875" y="873.21875" width="55.546875" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="626.6484375" y="898.2109375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="624.4296875">Room</tspan></text></g><line x1="642.203125" x2="642.203125" y1="88.875" y2="873.21875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="923.3125" y="50" width="84.4375" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="935.53125" y="74.4375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="933.3125">Lobby(s)</tspan></text></g><g class="actor"><rect x="923.3125" y="873.21875" width="84.4375" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="935.53125" y="897.65625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="933.3125">Lobby(s)</tspan></text></g><line x1="965.53125" x2="965.53125" y1="88.875" y2="873.21875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1027.75" y="50" width="78.875" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1039.96875" y="73.8828125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1037.75">Gateway</tspan></text></g><g class="actor"><rect x="1027.75" y="873.21875" width="78.875" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1039.96875" y="897.1015625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1037.75">Gateway</tspan></text></g><line x1="1067.1875" x2="1067.1875" y1="88.875" y2="873.21875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1308.84375" y="50" width="92.21875" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1321.0625" y="74.9921875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1318.84375">Client(s)</tspan></text></g><g class="actor"><rect x="1308.84375" y="873.21875" width="92.21875" height="38.875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1321.0625" y="898.2109375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1318.84375">Client(s)</tspan></text></g><line x1="1354.953125" x2="1354.953125" y1="88.875" y2="873.21875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="note"><rect x="20" y="108.875" width="145.546875" height="30" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="27.21875" y="129.421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="25">0. 匹配过程完成后</tspan></text></g><g class="note"><rect x="205.546875" y="158.875" width="416.65625" height="30" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="211.65625" y="179.421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="210.546875">1. 调用 CreateEntityAll("Space", ...)，创建Space实体</tspan></text></g><g class="note"><rect x="205.546875" y="208.875" width="230" height="30" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="211.65625" y="229.421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="210.546875">1-1. 本地创建Space实体类实例</tspan></text></g><g class="signal"><text x="284.984375" y="269.421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="283.875">1-2. 发送 CreateEntityReq 给 Room</tspan></text><line x1="185.546875" x2="642.203125" y1="278.875" y2="278.875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="662.203125" y="298.875" width="230" height="30" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="668.3125" y="319.421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="667.203125">1-3. 本地创建Space实体类实例</tspan></text></g><g class="note"><rect x="662.203125" y="348.875" width="283.328125" height="30" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="668.3125" y="369.421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="667.203125">2. 初始化场景（包括加载地图数据等）</tspan></text></g><g class="signal"><text x="294.4296875" y="390.2265625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="292.2109375">3. 通知初始化场景完成。</tspan><tspan dy="1.2em" x="292.2109375">(Scene.OnMapLoadSucceed函数内，</tspan><tspan dy="1.2em" x="292.2109375">发送RPC RoomSpaceInited)</tspan></text><line x1="642.203125" x2="185.546875" y1="457.265625" y2="457.265625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="440.5390625" y="487.8125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="438.3203125">4. Match通知Lobby，EnterScene (RPC)</tspan></text><line x1="185.546875" x2="965.53125" y1="497.265625" y2="497.265625" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="682.7578125" y="527.8125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="681.6484375">5. Lobby通知Room，EnterSpaceReq</tspan></text><line x1="965.53125" x2="642.203125" y1="537.265625" y2="537.265625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="note"><rect x="662.203125" y="557.265625" width="245.546875" height="68.390625" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="669.421875" y="577.8125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="667.203125">6. 在MsgProc_EnterSpaceReq内，</tspan><tspan dy="1.2em" x="667.203125">通过space.AddEntity，</tspan><tspan dy="1.2em" x="667.203125">创建Player实体类实例</tspan></text></g><g class="signal"><text x="715.8046875" y="646.609375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="713.5859375">6-1. 投递给客户端msgdef.EnterSpace，</tspan><tspan dy="1.2em" x="713.5859375">包含自己的IP、PORT</tspan></text><line x1="642.203125" x2="1067.1875" y1="684.84375" y2="684.84375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1079.40625" y="715.390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1077.1875">6-2. 投递给客户端msgdef.EnterSpace</tspan></text><line x1="1067.1875" x2="1354.953125" y1="724.84375" y2="724.84375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="863.578125" y="745.796875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="861.359375">7. 连接Room成功后(包括验证消息等)，</tspan><tspan dy="1.2em" x="861.359375">并发送SpaceUserConnect</tspan></text><line x1="1354.953125" x2="642.203125" y1="784.03125" y2="784.03125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="note"><rect x="662.203125" y="804.03125" width="270" height="49.1875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="669.421875" y="824.578125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="667.203125">8. 最终触发SpaceUserSess，</tspan><tspan dy="1.2em" x="667.203125">使client sess具备直接处理实体消息</tspan></text></g></svg>