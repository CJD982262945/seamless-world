### 玩家进入房间流程

// Space 空间实体
```go

type Space struct {
	entity.Entity
	iserver.ICoord
	*entity.Entities
	mapInfo *Map
	mapName string

	tinyEntities map[uint64]ITinyEntity

	startTime time.Time

	isMapLoaded bool

	dirtyEntities []*Entity
}


// room上的  Scene
type Scene struct {
	space.Space
	status          int                   //当前状态，
```
```go
WaitingScene::Go
{
    GetSrvInst().CreateEntityAll("Space", 0, mapStr, false)
}
Space::OnAfterInit()
{
    s.Entity.OnAfterInit()
    s.loadMap()
}


//space下的entity
Entity::OnAfterInit()
{
	 e.Entity.OnAfterInit()
	  e.onEnterSpace()
}


Entity::onEnterSpace()
{
	 ic, ok := e.GetRealPtr().(IEnterSpace)
	  if ok {
		ic.OnEnterSpace()
	 }

	if e.IsWatcher() {
		msg := &msgdef.EnterSpace{
			SpaceID:   e.GetSpace().GetID(),
			MapName:   e.GetSpace().GetInitParam().(string),
			EntityID:  e.GetID(),
      //房间地址
			Addr:      iserver.GetSrvInst().GetCurSrvInfo().OuterAddress,
			TimeStamp: e.GetSpace().GetTimeStamp(),
		}
		if err := e.Post(iserver.ServerTypeClient, msg); err != nil {
			e.Error("Send EnterSpace failed ", err)
		}

		e.aoies = append(e.aoies, AOIInfo{true, e})
	}
}

Space::loadMap()
{
  Maps::loadMap
	s.onLoadMapFinished(ret)
}

Maps::loadMap()
{
    path := fmt.Sprint("../res/space/", task.name, "/")
    mesh, pathFinder, err := ms.loadNavMesh(path)
    scene, err := unitypx.NewScene(path)
}
Space::loadMap() -> Space::onLoadMapFinished -> Scene::OnMapLoadSucceed ->

Scene::OnMapLoadSucceed()
{
    // 通知Match, Space创建完成, 新的匹配流程
    if err := tb.RPC(common.ServerTypeMatch, "RoomSpaceInited"); err != nil {
        log.Error(err, tb)
    }
}
//match 处理
SceneMsgProc::RPC_RoomSpaceInited()
{
	proc.scene.onRoomSceneInited()
	proc.scene.status = common.SpaceStatusClose
}

Scene::onRoomSceneInited()
{
	 for   obj := range scene.objs
   {
		   obj.onRoomSceneInited(scene.GetID())
   }
}


// 房间创建成功, 通知玩家进入场景
MatchMember::onRoomSceneInited(spaceid uint64)
{
	 if err := mm.RPC(common.ServerTypeLobby, "EnterScene", spaceid); err != nil
   {
		   log.Error(err, mm.EntityProxy)
	 }
}

//lobby处理
// RPC_EnterScene 通知客户端进入房间
LobbyUserMsgProc::RPC_EnterScene(spaceid uint64)
{
	   proc.user.EnterSpace(spaceid)
}

Entity::EnterSpace(spaceID uint64)
{

	sendFunc := func() {
		msg := &msgdef.EnterSpaceReq{
			SrvID:      srvID,
			SpaceID:    spaceID,
			EntityType: e.entityType,
			EntityID:   e.entityID,
			DBID:       e.dbid,
			InitParam:  serializer.Serialize(e.initParam),
			OldSrvID:   0,
			OldSpaceID: 0,
		}

		if err := iserver.GetSrvInst().PostMsgToCell(srvID, spaceID, msg); err != nil {
			e.Error("Enter space failed: ", err)
		}
	}

  sendFunc()

}

//room上创建
SpaceMsgProc::MsgProc_EnterSpaceReq(content msgdef.IMsg)
{
  //创建了player, room上也就是roomuser
	err := proc.space.AddEntity(msg.EntityType, msg.EntityID, msg.DBID, params[0], false, false)
	if err != nil {
		proc.space.Error("Add entity error ", err, msg)
		return
	}
}

RoomUser::Init(initParam interface{})
{
    user.RPC(common.ServerTypeLobby, "EnterRoomSuccess")
}

//lobby上处理
func  LobbyUserMsgProc::RPC_EnterRoomSuccess() {
	cost := time.Now().Sub(proc.user.enterRoomStamp).Nanoseconds() / 1000000
	proc.user.RPC(iserver.ServerTypeClient, "TransResult", "EnterSpace", true, cost)
}
```
